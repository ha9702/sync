sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/f/LayoutType","sap/ui/Device","sap/m/MessageBox","sap/ui/core/routing/History","sap/ui/core/UIComponent"],function(e,t,r,a,o,i,n){"use strict";return e.extend("sync.zec.sales1.controller.Home",{onInit:function(){var e=this.getOwnerComponent().getModel("cart");this.getView().setModel(e,"cart");var o=new t({layout:r.TwoColumnsMidExpanded});this.getView().setModel(o,"appView");a.media.attachHandler(this._onResize.bind(this),null,a.media.RANGESETS.SAP_STANDARD);e.setProperty("/productSelected",false);e.setProperty("/Submonth",0)},onToggleCart:function(e){var t=this.byId("flexibleColumnLayout");var a=e.getParameter("pressed");if(a){t.setLayout(r.ThreeColumnsMidExpanded)}else{t.setLayout(r.TwoColumnsMidExpanded)}},onAddToCart:function(){var e=this.getView().getModel("cart");var t=e.getProperty("/selectedProduct");if(!t||!t.Maktx||!t.selectedOption||!t.selectedOption.key){sap.m.MessageToast.show("선택된 상품이 없습니다.");return}var a=e.getProperty("/cartItems");var o=a.find(function(e){return e.Maktx===t.Maktx&&e.selectedOption.key===t.selectedOption.key});if(o){o.Quantity=(parseFloat(o.Quantity)+1).toFixed(2)}else{t.Matnr=t.selectedOption.key;t.Quantity="1.00";t.Image="/images/"+t.Matnr+".jpg";t.Netpr=t.selectedOption.Netpr;t.Waers=t.selectedOption.Waers;a.push(JSON.parse(JSON.stringify(t)))}e.setProperty("/cartItems",a);this._updateTotalPrice();var i=this.byId("flexibleColumnLayout");i.setLayout(r.ThreeColumnsMidExpanded);var n=this.byId("cartToggleButton");n.setPressed(true)},_updateTotalPrice:function(){var e=this.getView().getModel("cart");var t=e.getProperty("/cartItems");var r=0;t.forEach(function(e){var t=parseFloat(e.Netpr);r+=t*parseFloat(e.Quantity)});e.setProperty("/totalPrice",r)},onSelectProduct:function(e){var t=e.getSource().getBindingContext().getObject();var r=this.getView();var a=r.getModel("cart");a.setProperty("/selectedProduct",t);a.setProperty("/productSelected",true);var o=this.byId("idToSelect");var i="/ListItemSet('"+t.Matnr+"')/toSelect";o.bindAggregation("items",{path:i,template:new sap.ui.core.ListItem({key:"{Matnr}",text:"{Maktx}",additionalText:{parts:[{path:"Netpr"},{path:"Waers"}],formatter:this.formatCurrency}}),events:{dataReceived:function(){var e=o.getItems();if(e.length>0){var t=e[0];var r=t.getKey();var i=t.getText();var n=t.getAdditionalText();var[s,d]=n.split(" ");a.setProperty("/selectedProduct/selectedOption",{key:r,text:i,additionalText:n,Netpr:s,Waers:d});o.setSelectedKey(r)}}}});switch(t.Maktx){case"B-아르기닌":a.setProperty("/selectedProduct/AdditionalText","상품설명 : Special text for B-아르기닌");break;case"B-비타민B플러스":a.setProperty("/selectedProduct/AdditionalText","상품설명 : Details for B-비타민B플러스");break;case"B-밀크씨슬":a.setProperty("/selectedProduct/AdditionalText","상품설명 : Information about B-밀크씨슬");break;default:a.setProperty("/selectedProduct/AdditionalText","상품설명 : Default additional text");break}},_onResize:function(e){var t=this.getView().getModel("appView");var a=t.getProperty("/layout");if(e.name==="Phone"){if(a!==r.OneColumn){t.setProperty("/layout",r.OneColumn)}}else if(e.name==="Tablet"){if(a!==r.TwoColumnsStartExpanded){t.setProperty("/layout",r.TwoColumnsStartExpanded)}}else{if(a!==r.ThreeColumnsMidExpandedEndHidden){t.setProperty("/layout",r.ThreeColumnsMidExpandedEndHidden)}}},onEditCart:function(){var e=this.getView().getModel("cart");e.setProperty("/editMode",true)},onSaveChanges:function(){var e=this.getView().getModel("cart");e.setProperty("/editMode",false)},onDeleteItem:function(e){var t=e.getSource();var r=t.getBindingContext("cart");var a=r.getObject().Maktx;var i=r.getObject().selectedOption.key;var n=r.getModel();var s=n.getProperty("/cartItems");o.confirm("장바구니에서 상품을 삭제하시겠습니까?",{title:"상품 삭제",actions:["삭제","취소"],onClose:function(e){if(e==="삭제"){var t=s.filter(function(e){return e.Maktx!==a||e.selectedOption.key!==i});n.setProperty("/cartItems",t);this._updateTotalPrice()}}.bind(this)})},onPayment:function(){var e=n.getRouterFor(this);var t=this.getView().getModel("cart");var r=t.getProperty("/cartItems");t.setProperty("/Before","home");t.refresh(true);console.log(t.getProperty("/Before"));if(r.length>0){e.navTo("RoutePayment",{cartItems:encodeURIComponent(JSON.stringify(r)),sourceView:"home"})}else{sap.m.MessageToast.show("장바구니에 상품이 없습니다.")}},onSelectChange:function(e){var t=e.getParameter("selectedItem");var r=t.getKey();var a=t.getText();var o=t.getAdditionalText();var[i,n]=o.split(" ");var s=this.getView().getModel("cart");var d=s.getProperty("/selectedProduct");d.selectedOption={key:r,text:a,additionalText:o,Netpr:i,Waers:n};s.setProperty("/selectedProduct",d);var l=this.byId("productDetails");l.bindElement({path:"/selectedProduct",model:"cart"});console.log(d);this._updateTotalPrice()},onAvatarPress:function(){var e=this.getView().getModel("cart");var t=e.getProperty("/Kunnr");if(t){o.information("현재 로그인한 고객코드: "+t)}}})});
//# sourceMappingURL=Home.controller.js.map