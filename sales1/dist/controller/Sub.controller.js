sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/f/LayoutType","sap/ui/Device","sap/m/MessageBox","sap/ui/core/routing/History","sap/ui/core/UIComponent"],function(t,e,r,o,a,n,s){"use strict";return t.extend("sync.zec.sales1.controller.Sub",{onInit:function(){var t=this.getOwnerComponent().getModel("cart");this.getView().setModel(t,"cart");this._extractKunnrFromHash();var a=new e({layout:r.TwoColumnsMidExpanded});this.getView().setModel(a,"appView");o.media.attachHandler(this._onResize.bind(this),null,o.media.RANGESETS.SAP_STANDARD);t.setProperty("/productSelected",false);t.setProperty("/Submonth",3)},_extractKunnrFromHash:function(){var t=sap.ui.core.UIComponent.getRouterFor(this);var e=t.getRoute("RouteSub");e.attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(){var t=oEvent.getParameter("arguments").kunnr;if(t){var e=this.getView().getModel("cart");e.setProperty("/Kunnr",t);this._addItemsFromSessionStorage()}},_addItemsFromSessionStorage:function(){var t=this.getView().getModel("cart");var e=t.getProperty("/cartItems")||[];var r={};for(var o=0;o<sessionStorage.length;o++){var a=sessionStorage.key(o);var n=sessionStorage.getItem(a);if(n){r[n]=true}}var s=this.getView().byId("Sub").byId("idBotPanel").getItems();s.forEach(function(t){var o=t.getBindingContext().getObject();if(r[o.Matnr]){var a=e.find(function(t){return t.Matnr===o.Matnr});if(!a){var n=JSON.parse(JSON.stringify(o));n.Quantity=1;e.push(n)}}});t.setProperty("/cartItems",e);this._updateTotalPrice()},onToggleCart:function(t){var e=this.byId("flexibleColumnLayout");var o=t.getParameter("pressed");if(o){e.setLayout(r.ThreeColumnsMidExpanded)}else{e.setLayout(r.TwoColumnsMidExpanded)}},onAddToCart:function(){var t=this.getView().getModel("cart");var e=t.getProperty("/selectedProduct");if(!e||!e.Maktx){sap.m.MessageToast.show("선택된 상품이 없습니다.");return}var o=t.getProperty("/cartItems");var a=o.find(function(t){return t.Maktx===e.Maktx});if(a){sap.m.MessageToast.show("이미 추가된 상품입니다.")}else{e.Matnr=e.Matnr;e.Submonth=t.getProperty("/Submonth");e.Quantity=t.getProperty("/Submonth").toString();e.Image="/images/"+e.Matnr+".jpg";e.Netpr=parseFloat(e.Netpr)*30;e.Waers=e.Waers;o.push(JSON.parse(JSON.stringify(e)))}t.setProperty("/cartItems",o);this._updateTotalPrice();var n=this.byId("flexibleColumnLayout");n.setLayout(r.ThreeColumnsMidExpanded);var s=this.byId("cartToggleButton");s.setPressed(true)},onSubMonth:function(t){var e=this.getView().getModel("cart");var r=t.getParameter("value");e.setProperty("/Submonth",r);console.log(e);this._updateQuantitiesAndTotalPrice()},_updateQuantitiesAndTotalPrice:function(){var t=this.getView().getModel("cart");var e=t.getProperty("/cartItems");var r=t.getProperty("/Submonth");e.forEach(function(t){t.Quantity=r.toString()});t.setProperty("/cartItems",e);this._updateTotalPrice()},_updateTotalPrice:function(){var t=this.getView().getModel("cart");var e=t.getProperty("/cartItems");var r=0;e.forEach(function(t){var e=parseFloat(t.Netpr);r+=e*parseFloat(t.Quantity)});t.setProperty("/totalPrice",r)},onSelectProduct:function(t){var e=t.getSource().getBindingContext().getObject();var r=this.getView();var o=r.getModel("cart");console.log(e);console.log(o);o.setProperty("/selectedProduct",e);o.setProperty("/selectedProduct/pillNetpr",parseInt(e.Netpr));o.setProperty("/productSelected",true);switch(e.Maktx){case"P-아르기닌":o.setProperty("/selectedProduct/AdditionalText","상품설명 : Special text for P-아르기닌");break;case"P-비타민B플러스":o.setProperty("/selectedProduct/AdditionalText","상품설명 : Details for P-비타민B플러스");break;case"P-밀크씨슬":o.setProperty("/selectedProduct/AdditionalText","상품설명 : Information about P-밀크씨슬");break;default:o.setProperty("/selectedProduct/AdditionalText","상품설명 : Default additional text");break}},_onResize:function(t){var e=this.getView().getModel("appView");var o=e.getProperty("/layout");if(t.name==="Phone"){if(o!==r.OneColumn){e.setProperty("/layout",r.OneColumn)}}else if(t.name==="Tablet"){if(o!==r.TwoColumnsStartExpanded){e.setProperty("/layout",r.TwoColumnsStartExpanded)}}else{if(o!==r.ThreeColumnsMidExpandedEndHidden){e.setProperty("/layout",r.ThreeColumnsMidExpandedEndHidden)}}},onEditCart:function(){var t=this.getView().getModel("cart");t.setProperty("/editMode",true)},onSaveChanges:function(){var t=this.getView().getModel("cart");t.setProperty("/editMode",false)},onDeleteItem:function(t){var e=t.getSource();var r=e.getBindingContext("cart");var o=r.getObject().Maktx;var n=r.getModel();var s=n.getProperty("/cartItems");a.confirm("장바구니에서 상품을 삭제하시겠습니까?",{title:"상품 삭제",actions:["삭제","취소"],onClose:function(t){if(t==="삭제"){var e=s.filter(function(t){return t.Maktx!==o});n.setProperty("/cartItems",e);this._updateTotalPrice()}}.bind(this)})},onPayment:function(){var t=s.getRouterFor(this);var e=this.getView().getModel("cart");var r=e.getProperty("/cartItems");e.setProperty("/Before","sub");e.refresh(true);console.log(e.getProperty("/Before"));if(r.length>0){t.navTo("RoutePayment",{cartItems:encodeURIComponent(JSON.stringify(r)),sourceView:"sub"})}else{sap.m.MessageToast.show("장바구니에 상품이 없습니다.")}},onAvatarPress:function(){var t=this.getView().getModel("cart");var e=t.getProperty("/Kunnr");if(e){a.information("현재 로그인한 고객코드: "+e)}}})});
//# sourceMappingURL=Sub.controller.js.map